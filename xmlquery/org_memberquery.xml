<?xml version="1.0"  encoding="utf-8" ?>
<ROOT xmlns:sql="urn:schemas-microsoft-com:xml-sql"
	sql:xsl="org_memberquery03.xsl">
	<sql:header>
		<sql:param name='ENT_CODE'>General</sql:param>
		<sql:param name='UNIT_CODE'>00080</sql:param>
		<sql:param name='FLAG'>0</sql:param>
	</sql:header>
	<sql:query>
		SELECT [ORG_PERSON].*, B.PARENT_UNIT_CODE, C.NAME
		FROM [ORG_PERSON] , [ORG_UNIT] B, [ORG_UNIT] C
		WHERE [ORG_PERSON].UNIT_CODE = @UNIT_CODE
		AND	 [ORG_PERSON].USAGE_STATE = 'A'
		AND  [ORG_PERSON].UNIT_CODE = B.UNIT_CODE
		AND  B.PARENT_UNIT_CODE = C.UNIT_CODE	
		AND	 B.USAGE_STATE = 'A'
		AND	 C.USAGE_STATE = 'A'
		ORDER BY [ORG_PERSON].SORT_KEY ASC
		FOR XML AUTO
	</sql:query>
	<sql:query>
		SELECT [ORG_ADDITIONALJOB].*, B.NAME, B.PARENT_UNIT_CODE, C.NAME, D.*, E.NAME, F.NAME
		FROM 	[ORG_ADDITIONALJOB]  WITH (NOLOCK), [ORG_UNIT] B WITH (NOLOCK), [ORG_UNIT] C  WITH (NOLOCK), [ORG_PERSON] D  WITH (NOLOCK), [ORG_JOBTITLE] E  WITH (NOLOCK), [ORG_JOBPOSITION] F  WITH (NOLOCK)
		WHERE 	[ORG_ADDITIONALJOB].UNIT_CODE = @UNIT_CODE
		AND  	[ORG_ADDITIONALJOB].UNIT_CODE = B.UNIT_CODE
		AND   	B.PARENT_UNIT_CODE = C.UNIT_CODE
		AND		B.USAGE_STATE = 'A'
		AND		C.USAGE_STATE = 'A'
		AND		[ORG_ADDITIONALJOB].PERSON_CODE = D.PERSON_CODE
		AND		[ORG_ADDITIONALJOB].UNIT_CODE != D.UNIT_CODE
		AND 	D.USAGE_STATE = 'A'
		AND  	[ORG_ADDITIONALJOB].TITLE_CODE = E.TITLE_CODE
		AND  	[ORG_ADDITIONALJOB].TITLE_CODE = F.PSTN_CODE
		FOR XML AUTO
	</sql:query>
</ROOT>
