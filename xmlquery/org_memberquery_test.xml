<?xml version="1.0"  encoding="utf-8" ?>
<ROOT xmlns:sql="urn:schemas-microsoft-com:xml-sql">
	<sql:header>
		<sql:param name='ENT_CODE'>General</sql:param>
		<sql:param name='UNIT_CODE'>00080</sql:param>
		<sql:param name='FLAG'>0</sql:param>
	</sql:header>
	<sql:query>
		SELECT [ORG_PERSON].*, B.PARENT_UNIT_CODE, C.NAME
		FROM [ORG_PERSON] , [ORG_UNIT] B, [ORG_UNIT] C, [ORG_JOBPOSITION] D
		WHERE 	[ORG_PERSON].ENT_CODE = @ENT_CODE
		AND  [ORG_PERSON].UNIT_CODE = @UNIT_CODE
		AND	 [ORG_PERSON].USAGE_STATE = 'A'
		AND  [ORG_PERSON].UNIT_CODE = B.UNIT_CODE
		AND  B.PARENT_UNIT_CODE = C.UNIT_CODE	
		AND	 B.USAGE_STATE = 'A'
		AND	 C.USAGE_STATE = 'A'
		ORDER BY [ORG_PERSON].TITLE_CODE ASC, [ORG_PERSON].LEVEL_CODE ASC
		FOR XML AUTO
	</sql:query>
	<sql:query>
		SELECT [ORG_ADDITIONALJOB].*, B.NAME, B.PARENT_UNIT_CODE, C.NAME, D.*
		FROM 	[ORG_ADDITIONALJOB]  WITH (NOLOCK)  , [ORG_UNIT] B WITH (NOLOCK)  , [ORG_UNIT] C  WITH (NOLOCK)  , [ORG_PERSON] D  WITH (NOLOCK)  
		WHERE 	[ORG_ADDITIONALJOB].UNIT_CODE = @UNIT_CODE
		AND  	[ORG_ADDITIONALJOB].UNIT_CODE = B.UNIT_CODE
		AND	[ORG_ADDITIONALJOB].PERSON_CODE = D.PERSON_CODE
		AND	[ORG_ADDITIONALJOB].UNIT_CODE != D.UNIT_CODE
		AND   	B.PARENT_UNIT_CODE = C.UNIT_CODE
		AND	B.USAGE_STATE = 'A'
		AND	C.USAGE_STATE = 'A'
		AND 	D.USAGE_STATE = 'A'
		FOR XML AUTO
	</sql:query>
	<sql:query>
		SELECT 	[ORG_DISPATCHEDJOB].*, B.NAME, B.PARENT_UNIT_CODE, C.NAME, D.*
		FROM 	[ORG_DISPATCHEDJOB]  WITH (NOLOCK)  , [ORG_UNIT] B  WITH (NOLOCK)  , [ORG_UNIT] C WITH (NOLOCK)  , [ORG_PERSON] D WITH (NOLOCK)  
		WHERE 	[ORG_DISPATCHEDJOB].UNIT_CODE = @UNIT_CODE
		AND  	[ORG_DISPATCHEDJOB].UNIT_CODE = B.UNIT_CODE
		AND	[ORG_DISPATCHEDJOB].PERSON_CODE = D.PERSON_CODE
		AND	[ORG_DISPATCHEDJOB].UNIT_CODE != D.UNIT_CODE
		AND   	B.PARENT_UNIT_CODE = C.UNIT_CODE
		AND	B.USAGE_STATE = 'A'
		AND	C.USAGE_STATE = 'A'
		AND  	D.USAGE_STATE = 'A'
		FOR XML AUTO
	</sql:query>
	<sql:query>
	if @FLAG = '1'
		SELECT [ORG_UNIT].NAME AS UNIT_NAME, [ORG_UNIT].UNIT_CODE, [ORG_UNIT].NAME AS NAME, '00' AS SORT_KEY, 'manager' AS JOBTITLE, [ORG_UNIT].PARENT_UNIT_CODE, C.NAME
		FROM [ORG_UNIT] WITH (NOLOCK)  , [ORG_UNIT] C WITH (NOLOCK)
		WHERE 	[ORG_UNIT].UNIT_CODE = @UNIT_CODE
		AND	[ORG_UNIT].USAGE_STATE = 'A'
		AND  [ORG_UNIT].PARENT_UNIT_CODE = C.UNIT_CODE
		AND	C.USAGE_STATE = 'A'
		FOR XML AUTO
	</sql:query>
</ROOT>
