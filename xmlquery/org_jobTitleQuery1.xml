<?xml version="1.0"  encoding="UTF-8" ?>
<ROOT xmlns:sql="urn:schemas-microsoft-com:xml-sql" sql:xsl="org_jobTitleQuery1.xsl">

	<sql:header>		
		<sql:param name='PARENT_TITLE_CODE'>E00</sql:param>
		<sql:param name='ENT_CODE'>H</sql:param>
	</sql:header>
	<sql:query>

		SELECT * 
		FROM [ORG_PERSON]
		WHERE [ORG_PERSON].[TITLE_CODE] IN (
			SELECT [ORG_JOBTITLE].[TITLE_CODE] FROM [ORG_JOBTITLE] 
			WHERE [ORG_JOBTITLE].[PARENT_TITLE_CODE] = @PARENT_TITLE_CODE )
		AND	[ORG_PERSON].[ENT_CODE] = @ENT_CODE
			ORDER BY LEVEL_CODE, DISPLAY_NAME
		FOR XML AUTO
	</sql:query>	
	<sql:query>


		SELECT [ORG_ADDITIONALJOB].*, B.PARENT_UNIT_CODE, C.NAME, D.*
		FROM [ORG_ADDITIONALJOB] , [ORG_UNIT] B, [ORG_UNIT] C, [ORG_PERSON] D
		WHERE [ORG_ADDITIONALJOB].[TITLE_CODE] IN (
			SELECT [ORG_JOBTITLE].[TITLE_CODE] FROM [ORG_JOBTITLE] 
			WHERE [ORG_JOBTITLE].[PARENT_TITLE_CODE] = @PARENT_TITLE_CODE )

		AND  [ORG_ADDITIONALJOB].UNIT_CODE = B.UNIT_CODE	
		AND   B.PARENT_UNIT_CODE = C.UNIT_CODE
		AND	 B.USAGE_STATE = 'A'
		AND	 C.USAGE_STATE = 'A'
		AND	[ORG_ADDITIONALJOB].PERSON_CODE = D.PERSON_CODE
		AND	[ORG_ADDITIONALJOB].UNIT_CODE != D.UNIT_CODE
		AND D.USAGE_STATE = 'A'
		ORDER BY LEVEL_CODE, DISPLAY_NAME
		FOR XML AUTO
	</sql:query>	
</ROOT>
