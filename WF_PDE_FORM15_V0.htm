<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="Cache-Control" content="no-cache" />
	<meta http-equiv="Pragma" content="no-cache" />		
	<link rel="stylesheet" type="text/css" href="/GWImages/covi/app_css_style.css" />
    <!--필수 양식파일에 쓰이는 js 파일-->
    <script language="javascript" src="../../Common/script/COVIFlowNet/openWindow.js" type="text/javascript"></script>		
	<script language="javascript" src="formedit.js" type="text/javascript"></script>
	<script language="javascript" src="../../Common/script/progress.js" type="text/javascript"></script>
    <!--여기까지 무조건 넣어야 함-->
	<script type="text/javascript" language="javascript" src="../../common/script/NameControl.js"></script>
	
	<!-- imageUpload추가된 vbs화일   -->
	<!--<script language="VBScript"   src="imageUpload.vbs"></script>-->
	<!-- 달력 선택 참조  -->
	<script language="JavaScript" src="calendar/__cal.js" type="text/javascript"></script>
	<script language="vbscript" src="calendar/__cal.vbs" type="text/vbscript"></script>
	<!-- 보광 공통 -->
	<script src="/CoviWeb/SiteReference/js/Config.js" type="text/javascript"></script>
    <script src="/CoviWeb/SiteReference/js/ClientMessageBox.js" type="text/javascript"></script>
    <script src="/CoviWeb/SiteReference/js/EmbedObject.js" type="text/javascript"></script>
    <script src="/CoviWeb/SiteReference/js/Utility.js" type="text/javascript"></script>
		
</head>

<body topmargin="0" leftmargin="0" scroll="auto" align="center">
<!-- COMMON FIELDS -->
<input type="hidden" id="dField" name="INITIATOR_NAME" dataFld="usdn">
<input type="hidden" id="Hidden1" name="INITIATOR_ID" dataFld="usid">
<input type="hidden" id="Hidden2" name="INITIATOR_OU_NAME" dataFld="dpdn_apv">
<input type="hidden" id="Hidden3" name="INITIATOR_OU_ID" dataFld="dpid_apv">
<input type="hidden" id="cField" name="LAST_MODIFIER_ID"> 
<input type="hidden" id="Hidden4" name="attach">
<input type="hidden" id="Hidden5" name="filelocation" dataFld="fmfl">
<input type="hidden" id="Hidden6" name="ATTACH_FILE" value="">
<input type="hidden" id="Hidden7" name="ATTACH_FILE_INFO" value="" dataFld="ATTACH_FILE_INFO">
<input type="hidden" id="Hidden8" name="INITIATOR_INFO" value="" dataFld="INITIATOR_INFO">
<input type="hidden" id="Hidden9" name="APPLIED" dataFld="APPLIED">										
<input type="hidden" id="Hidden10" name="ISPUBLIC" dataFld="ISPUBLIC">
<input type="hidden" id="Hidden11" name="APPLIED_TERM" dataFld="APPLIED_TERM">
<input type="hidden" id="Hidden12" name="RECEIVE_NO" dataFld="RECEIVE_NO">
<input type="hidden" id="Hidden13" name="RECEIVE_NAMES" dataFld="RECEIVE_NAMES">
<input type="hidden" id="Hidden14" name="RECEIPT_LIST" dataFld="RECEIPT_LIST">
<!--<input type="hidden" id="dField" name="DOC_LEVEL"  dataFld="DOC_LEVEL">
<input type="hidden" id="dField" name="SAVE_TERM"  dataFld="SAVE_TERM">-->
<input type="hidden" id="Hidden15" name="DOC_CLASS_ID" dataFld="DOC_CLASS_ID">
<input type="hidden" id="Hidden16" name="SUBJECT" dataFld="SUBJECT">
<input type="hidden" id="Hidden17" name="DOC_NO" dataFld="DOC_NO">
<input type="hidden" id="Hidden18" name="DOC_OU_NAME" dataFld="dpdsn">
<input type="hidden" id="Hidden19" name="ENT_CODE" dataFld="etid">
<input type="hidden" id="Hidden20" name="ENT_NAME" dataFld="etnm"><input type="hidden" id="mField" name="DOC_LEVEL_NAME" />

<textarea  id="Textarea1" name="DOC_SUMMARY" dataFld="DOC_SUMMARY" style="display:none"></textarea>
<textarea id="dhtml_body" style="display:none"></textarea>
<textarea style="display:none" id="Textarea2" name="xsl"></textarea> 

<!-- 문서link 2006.01 -->
<textarea id="Textarea3" name="DOCLINKS" style="display:none"></textarea>
<!-- END -->
<!-- 양식전체본문 -->
	<div id="bodytable">
		<!-- header start -->
		<table id="headtable" border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse;" align="center" width="740"  >
			<tr>
				<td width="100%" height="5" valign="top" ></td>
			</tr>	
			<tr>
				<td nowrap="t" height="46" width="100%" align="center" >
					<table border="0" bordercolor="#111111" style="border-collapse: collapse;MARGIN-TOP: 0px; width:100%;height:100%;" >
						<tr>
							<td align="center" id="headname" style="font-family:HY헤드라인M;font-size:18pt;font-weight:bolder;line-height: 100%;" ></td>
						</tr>
					</table>
				</td>
			</tr>
			<!-- 결재선 정보 시작-->
			<!-- 일반결재/합의 -->
			<tr>
			    <td id="AppLine" width="100%">
		            <table border="0" width="100%" height="100%" cellpadding="0" cellspacing="0" bordercolordark="white" bordercolorlight="gray">
			            <tr>
				            <!-- 발신처 결재란 보이는 부분(왼쪽) -->
				            <td id="LApvLine" align="left" width="100%"></td>
			            </tr>
			            <tr>
				            <!-- 수신처 결재란 보이는부분 (오른쪽)-->
				            <td id="RApvLine" align="left" width="100%"></td>
			            </tr>
		            </table>
			    </td>
			</tr>
			<!-- 협조자 -->
			<tr>
			    <td align="center" id="AssistLine" width="100%" style="display:none;"></td>
			</tr>
			<!--참조자 -- 첨부파일 영역으로 옮김 -->
			<!--수신자 -->
			<tr>
				<td align="center" id="RRLine" width="100%" style="display:none;"></td>
			</tr>			
			<!-- 결재선 정보 종료-->
			<!-- 문서정보
			보안등급 : 공개/대외비/중요/극비
			보존년한 : 1/3/5/7/10/영구
			문서분류 : 문서이관 시스템 선택
			문서번호 : 문서번호
			사업장구분 : (주)보광일 경우 사용
			-->
			<tr>
			    <td width="100%">
          			<table border="2" bordercolor="#111111" style="border-collapse: collapse;MARGIN-TOP: 0px; width:100%;height:100%;">			
	                  <tr>
		                <td width="15%" align="center" valign="middle" style='background:#eff2f7;font-size:9pt;font-weight:bold;'>보안등급</td>
		                <td width="35%" valign="middle">&nbsp;<select id="Select1" name="DOC_LEVEL" onchange="DOC_LEVEL_Change(this);"></select></td>
		                <td width="15%" align="center" valign="middle" style='background:#eff2f7;font-size:9pt;font-weight:bold;'>보존년한</td>
		                <td width="35%" valign="middle">&nbsp;<select id="Select2" name="SAVE_TERM"></select></td>
	                  </tr>
	                  <tr>
		                <td width="15%" align="center"  valign=middle style='background:#eff2f7;font-size:9pt;font-weight:bold;'>문서분류</td>
		                <td width="35%" valign="middle">&nbsp;<input type="TEXT" id="TEXT1" name="DOC_CLASS_NAME" dataFld="DOC_CLASS_NAME" size="20" readonly />&nbsp;<img src="/GWImages/Covi/Common/btn/btn_organization.gif" name="btn_Process" id="btn_Process" align="absMiddle"
										border="0" onClick="OpenDocClass();" style="cursor:hand" /></td>
		                <td width="15%" align="center"  valign="middle" style='background:#eff2f7;font-size:9pt;font-weight:bold;'>문서번호</td>
		                <td width="35%" valign="middle">&nbsp;</td>
	                  </tr>
	                  <tr id="partdisplay" style="display:none;">
		                <td width="15%" align="center"  valign=middle style='background:#eff2f7;font-size:9pt;font-weight:bold;'>사업장분류</td>
		                <td colspan="3" width="85%" valign="middle" >&nbsp;<select id="Select3" name="SEL_ENTPART"></select></td>
	                  </tr>
	                  <tr height="25" id="workrequestdisplay" style="display:none;">
		                <td width="15%" align="center"  valign=middle style='background:#eff2f7;font-size:9pt;font-weight:bold;'>관련업무의뢰</td>
		                <td colspan="3" width="85%" valign="middle" >&nbsp;<input type="hidden" id="mField" name="WORKREQUEST_ID" /><input type="TEXT" id="mField" name="WORKREQUEST_NAME" size="20" readonly />&nbsp;<a href="#" class="Btn02" onClick="javascript:OpenWorkRequest();" name="btn_Process" id="btnSelectWorkList"><span>추가</span></a> 
		                        <a href="#" class="Btn02" onClick="javascript:DelWorkRequest();" name="btn_Process" id="Img1"><span>삭제</span></a>
						</td>
	                  </tr>
                   </table>
                   
		        </td>
		    </tr> 
			<tr>
				<td width="100%" height="1" valign="top"></td>
			</tr>			
		</table>
		<!-- header end -->
		<table border="0" cellpadding="0" cellspacing="0" align="center" width="740"><tr><td height="2"></td></tr></table>
		<!-- bodycontext start -->
		<table id="bodycontext" border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse;" align="center" width="740">
		<tr>
		<td width="740">
		    <table border="2" bordercolor="#111111" style="border-collapse: collapse;MARGIN-TOP: 0px; width:740;height:400;">
                <tr>
                    <td width="15%" height="25" align="center" style='background:#eff2f7;font-size:9pt;font-weight:bold;'>제&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;목</td> 
                    <td width="85%" height="25">&nbsp;<input id="Text3" name='mSUBJECT' datafld='SUBJECT' style="border:1px solid #C0C0C0; font-size:9pt;padding-left:4;padding-top:5;width:98%; height: 25; font-weight:bold;"></td>
                </tr>														
			    <!--실 결재양식 내용 부분 시작 -->
			    <!-- 나모 에디터 시작 -->
			    <TR height="100%">
				    <td colspan="2" width="100%" height="100%">
					<div id="DhtmlBody" name="DhtmlBody">
					    <script type="text/javascript" language="javascript" src="editControl.js"></script>
				    </div>
				    </td>
			    </tr>			
			   <!-- 나모 에디터 끝 -->
			    <!--실 결재양식 내용 부분 끝 -->
		    </table>
		</td>
		</tr>
		<!-- bodycontext end -->
		<table border="0" cellpadding="0" cellspacing="0" align="center" width="740"><tr><td height="2"></td></tr></table>
		<table border="2" bordercolor="#111111" cellpadding="0" cellspacing="0" style="border-collapse: collapse;"
			align="center" width="740" height="75">
			<tr height="25">
                <td width="15%" height="25" align="center" style='background:#eff2f7;font-size:9pt;font-weight:bold;'>통&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;보</td> 
				<td width="85%" id="CCLine" style='padding-left:2px;font-size:9pt;'>
				    <div id="SendCC"></div>
				    <div id="RecCC"></div>
				</td>
			</tr>
			<tr height="25">
				<td width="15%" align="center" style='background:#eff2f7;font-size:9pt;font-weight:bold;'>첨부파일</td>
				<td width="85%" id="AttFileInfo" style='padding-left:2px;font-size:9pt;'></td>
			</tr>
			<tr height="25">
				<td width="15%" height="24" align="center" style='background:#eff2f7;font-size:9pt;font-weight:bold;'>연결문서</td>
				<td width="85%" id="DocLinkInfo" style="font-size:9pt;padding-left:2px;"></td>
			</tr>
			<!-- 
			<tr height="20">
				<td width="80" align="center" style='background:#D7D7D7;font-size:9pt;font-weight:bold;'>EDM문서</td>
				<td><span id="EDMSLinkInfo" style='padding-left:8px;font-size:9pt;'></span></td>
			</tr>-->
		</table>
		<table border="0" cellpadding="0" cellspacing="0" align="center" width="740"><tr><td height="2"></td></tr></table>		
		</div>
		<!-- 양식 전체 end -->
		<!-- 달력선택 div 시작 -->
		<div id="minical" OnClick="this.style.display='none';" oncontextmenu="return false" ondragstart="return false"
		onselectstart="return false" style="background : buttonface; margin: 5; margin-top: 2;border-top: 1 solid buttonhighlight;border-left: 1 solid buttonhighlight;border-right: 1 solid buttonshadow;border-bottom: 1 solid buttonshadow;width:175;display:none;position: absolute; z-index: 2"></div>
		<iframe id="frmcal"  scrolling="no" frameborder="0" style="background : buttonface; margin: 5; margin-top: 2;border-top: 0 solid buttonhighlight;border-left: 0 solid buttonhighlight;border-right: 0 solid buttonshadow;border-bottom: 0 solid buttonshadow;width:175;display:none;position: absolute; z-index: 1"></iframe>
        <!-- 달력선택 div 종료 -->
        <div id="divforminfo" style="display:none">
        	<table border="2" bordercolor="#111111" cellpadding="0" cellspacing="0" style="border-collapse: collapse;"
			align="center" width="740" >
			    <tr height="25">
                    <td width="15%" height="25" align="center" style='background:#eff2f7;font-size:9pt;font-weight:bold;'>문서설명</td> 
				    <td width="85%" id="tdforminfo" style="padding-left:2px;font-size:9pt;"></td>
			    </tr>
    		</table>
        </div>
</body>

<SCRIPT LANGUAGE="JavaScript">
function window.onload(){				
	initialize();
}

function initialize(){
	if(window.parent.document.readyState == "complete"){
		window.parent.document.onreadystatechange = event_noop;	
		initENTPART();//사업장 코드 조회		
		initForm();
		initApvList();
	}else{
		window.setTimeout(initialize,500);
	}				
}

function initForm(){
	// window.top.resizeTo(800,720);
	initFields();
	G_displaySpnAttInfo(false);
	//if(getInfo("pdefname").indexOf("ApprovalSystem-Draft") != -1) {parent.menu.recedit.style.display="none";}
}
function initFields(szBody){
	setFields(dField);//editable field
	setFields(cField); //readonly field

	headname.innerHTML = getInfo("fmnm");
	if (getInfo("mode") == "DRAFT" || getInfo("mode") == "TEMPSAVE" ){		
		INITIATOR_INFO.value = getInfo("usdn");//getInfo("dpdn_apv")+" "+getInfo("usdn") + " "+ getInfo("ustn") ;
		APPLIED.value = formatDate(getInfo("svdt"),"D");		
	}else{
		mSUBJECT.disabled = true
	
	}
	//기타 필드 채우기	
	setSaveTerm(); //보존년한 create	
	setDocLevel();  // 보안등급 create

	//본문 내용 
	if (getInfo("BODY_CONTEXT") != undefined){	
		//setBodyContext(getInfo("BODY_CONTEXT"));
	}else{
	}
}

function getBodyContext(){
	dhtml_body.value = tbContentElement.HtmlValue;	

    //본문 내용 및 기타 계산 필드 넘기기, 현재 본문내용만 넘김
	SUBJECT.value = mSUBJECT.value
	UpdateImageData(); //이미지 업로드
	var sBodyContext = makeBodyContext();
	return makeNode("BODY_CONTEXT",sBodyContext,null,false);
}

function setFields(Fields){
	for(var i=0;i<Fields.length;i++){
		var fld = Fields[i];
		if(fld.dataFld!=""){(getInfo(fld.name)!=undefined)? fld.value=getInfo(fld.name):(getInfo(fld.dataFld)!=undefined)?fld.value=getInfo(fld.dataFld):fld.value='';}
		if(fld.name == 'POSITION' && getInfo(fld.name) == ""){
			fld.value = getInfo(fld.dataFld);
		}

	}
}
function checkForm(bTempSave){
	SUBJECT.value = mSUBJECT.value;
	if (bTempSave){
		return true;
	}else{
		if(SUBJECT.value == '' ){
			alert('제목을 입력하세요.');
			//SUBJECT.focus();
			return false;
		}else if(SAVE_TERM.value == ''){
			alert('보존년한을 선택하세요.');
			return false;
		}else{
			return true;
		}
	}
}

function setBodyContext(sBodyContext){
	//본문 채우기
	var m_objXML=new ActiveXObject("MSXML2.DOMDocument");
	var elmList, elm;
	var elmListLan;
	
	m_objXML.loadXML("<?xml version='1.0' encoding='utf-8'?>"+getInfo("BODY_CONTEXT"));
	try{
		elmList = m_objXML.documentElement.childNodes;
		for(var i=0; i < elmList.length; i++){
			var elm = elmList.item(i);
			innerHtmlData(elm.nodeName, elm.text);
		}
		//본문 채우기
		setdField();
	}
	catch(e){ }
}

//본문 XML로 구성
function makeBodyContext(){
	var sBodyContext="";	
	//xml 구성 예제 : <body><item><name></name></item><item><name></name></item></body>
	//sBodyContext="<body><item><name>첫번째</name></item><item><name>두번째</name></item></body>";
	
	sBodyContext = "<BODY_CONTEXT>" +  "<tbContentElement><![CDATA[" + dhtml_body.value +  "]]></tbContentElement>" + getFields(mField) + "</BODY_CONTEXT>";	
	return sBodyContext;
}

/*** form data -> xml ***/
function getFields(Fields){
	var sText = "";
	for(var i=0;i<Fields.length;i++){
	    if (Fields[i].name.indexOf("SEL_") > -1){
    		sText += getSelRadio(Fields[i].name);
	    }else{
    		sText += makeNode(Fields[i].name, Fields[i].value);
	    } 
	}
	return sText;
}	

/*** Radio Button 값 가져오기***/
function getRadio(radioNm){	
	var radioVal = "";
	//alert("이름:"+radioNm+"\n객체여부:"+eval(radioNm)+"\n길이:"+eval(radioNm).length+"\n체크여부:"+eval(radioNm).checked);
	for(i=0;i<eval(radioNm).length;i++){				
		if(eval(radioNm)[i].checked){
			radioVal = makeNode(radioNm, eval(radioNm)[i].value);
		}
	}
	return radioVal;
}

/*** Single Radio Button Value 가져오기 ***/
function getChkRadio(radioNm){
	if(eval(radioNm).checked){
		radioVal = makeNode(radioNm, eval(radioNm).value);
		return radioVal;
	}
}
/** SELECT BOX VALUE 가져오기 **/
function getSelRadio(selNm){
	var radioVal = "";
    radioVal = makeNode(selNm, eval(selNm).value);
    radioVal += makeNode(selNm+"_TEXT", eval(selNm).options[eval(selNm).selectedIndex].text);
    return   radioVal  
}
/*** 데이터 뿌려주기 ***/
function innerHtmlData(nodeNm, nodeVal){
	if (document.all[nodeNm] != undefined) {
		if (nodeNm.indexOf("FORM_ATTACH") != -1) {
			setForm_Attach(nodeVal);
			eval(nodeNm).value = nodeVal;
		} else if (nodeNm.indexOf("tbContentElement") != -1) {
			var dom = tbContentElement.getDom();	dom.body.innerHTML= nodeVal.replace(/<BR>/gi,"");
		} else if(nodeNm.indexOf("OPT") != -1) {
			setRadio(nodeNm, nodeVal);
		} else if(nodeNm.indexOf("CHK") != -1) {
			setChk(nodeNm, nodeVal);
		} else if(nodeNm.indexOf("JEONKEUL") != -1) {
		    spnJEONKEUL.innerHTML = nodeVal;
		} else {
			eval(nodeNm).value = nodeVal;
		}
	}
}

/*** 라디오 버튼 value display ***/
function setRadio(szname, szvalue){	
	var objrdo = eval(szname);
	for(i=0;i<objrdo.length;i++){	
		if(objrdo[i].value == szvalue) objrdo[i].checked = true;
	}
}

/*** single 라디오 버튼 value display ***/
function setChk(szname, szvalue){	
	var objrdo = eval(szname);
	if(objrdo.value == szvalue) objrdo.checked = true;
}


</SCRIPT>
<!-- 태그프리 추가-->
<script language="JScript" FOR="tbContentElement" EVENT="OnControlInit">
   //본문 내용 
   if (getInfo("BODY_CONTEXT") != undefined){     //기안,임시저장으로 저장된 값 setting
        /*
       var m_objXML = new ActiveXObject("MSXML2.DOMDocument");
       m_objXML.loadXML("<root>"+getInfo("BODY_CONTEXT")+"</root>");

       try{tbContentElement.HtmlValue = m_objXML.documentElement.selectSingleNode("TagFree").text;}catch(e){}
       */
       setBodyContext(getInfo("BODY_CONTEXT"));
       try{G_displaySpnDocLinkInfo();}catch(e){}

   }else {//양식 생성 시 입력한 본문내역 조회            
        if (getInfo("fmbd") != "undefined")
        {
         try{var dom = tbContentElement.getDom();	dom.body.innerHTML= getInfo("fmbd");}catch(e){}
        }
   }     

</script>

</html>
